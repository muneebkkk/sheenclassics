<%- include('../partials/header') %>

    <main>
        <section class="section" style="padding-top:3rem;">
            <div class="container admin-container">

                <!-- Header -->
                <div class="admin-header reveal">
                    <div>
                        <span style="font-size:0.7rem;font-weight:600;letter-spacing:0.25em;text-transform:uppercase;color:var(--gold);display:block;margin-bottom:0.4rem;">Control Panel</span>
                        <h1 class="admin-title">Admin <em style="font-family:var(--font-serif);font-style:italic;font-weight:300;">Dashboard</em></h1>
                    </div>
                    <a href="/" class="btn btn-add-cart" style="display:inline-flex;align-items:center;gap:6px;padding:0.7rem 1.4rem;font-size:0.78rem;text-decoration:none;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                        <span>Back to Site</span>
                    </a>
                </div>

                <!-- Stats Grid -->
                <div class="admin-stats">
                    <div class="stat-card reveal">
                        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;">
                            <div style="width:40px;height:40px;background:var(--gold-pale);border:1px solid var(--border-gold);border-radius:var(--radius);display:flex;align-items:center;justify-content:center;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="1.5"><path d="M20 7H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/><polyline points="16 3 12 7 8 3"/></svg>
                            </div>
                            <span style="font-size:0.65rem;font-weight:700;letter-spacing:0.15em;text-transform:uppercase;color:var(--text-muted);">Products</span>
                        </div>
                        <div class="stat-value">
                            <%= totalProducts %>
                        </div>
                        <div class="stat-label">Total Products</div>
                    </div>

                    <div class="stat-card reveal reveal-delay-1">
                        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;">
                            <div style="width:40px;height:40px;background:var(--gold-pale);border:1px solid var(--border-gold);border-radius:var(--radius);display:flex;align-items:center;justify-content:center;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="1.5"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                            </div>
                            <span style="font-size:0.65rem;font-weight:700;letter-spacing:0.15em;text-transform:uppercase;color:var(--text-muted);">Orders</span>
                        </div>
                        <div class="stat-value">
                            <%= totalOrders %>
                        </div>
                        <div class="stat-label">Total Orders</div>
                    </div>

                    <div class="stat-card reveal reveal-delay-2">
                        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;">
                            <div style="width:40px;height:40px;background:var(--gold-pale);border:1px solid var(--border-gold);border-radius:var(--radius);display:flex;align-items:center;justify-content:center;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="1.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            </div>
                            <span style="font-size:0.65rem;font-weight:700;letter-spacing:0.15em;text-transform:uppercase;color:var(--text-muted);">Users</span>
                        </div>
                        <div class="stat-value">
                            <%= totalUsers %>
                        </div>
                        <div class="stat-label">Registered Users</div>
                    </div>

                    <div class="stat-card reveal reveal-delay-3">
                        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;">
                            <div style="width:40px;height:40px;background:var(--gold-pale);border:1px solid var(--border-gold);border-radius:var(--radius);display:flex;align-items:center;justify-content:center;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="1.5"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                            </div>
                            <span style="font-size:0.65rem;font-weight:700;letter-spacing:0.15em;text-transform:uppercase;color:var(--text-muted);">Revenue</span>
                        </div>
                        <div class="stat-value" style="font-size:2rem;">Rs
                            <%= totalRevenue.toFixed(0) %>
                        </div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                </div>

                <!-- Recent Orders Table -->
                <div class="reveal" style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);overflow:hidden;margin-bottom:2rem;">
                    <div style="padding:1.5rem 2rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;">
                        <h2 style="font-family:var(--font-serif);font-size:1.5rem;font-weight:400;color:var(--primary);">Recent Orders</h2>
                        <a href="/admin/orders" style="font-size:0.78rem;font-weight:600;letter-spacing:0.08em;color:var(--gold);display:flex;align-items:center;gap:4px;">
                        View All
                        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    </a>
                    </div>

                    <% if (recentOrders && recentOrders.length > 0) { %>
                        <div class="table-wrap" style="border:none;border-radius:0;box-shadow:none;">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% recentOrders.forEach(order => { %>
                                        <tr>
                                            <td>
                                                <span style="font-family:var(--font-display);font-size:0.82rem;font-weight:600;letter-spacing:0.04em;">#<%= order._id.toString().substring(0, 8).toUpperCase() %></span>
                                            </td>
                                            <td>
                                                <div style="font-weight:500;color:var(--text-primary);font-size:0.9rem;">
                                                    <%= order.user.name %>
                                                </div>
                                            </td>
                                            <td>
                                                <span style="font-weight:600;color:var(--primary);">Rs <%= order.total.toFixed(2) %></span>
                                            </td>
                                            <td><span class="badge badge-<%= order.status %>"><%= order.status %></span></td>
                                            <td style="color:var(--text-muted);font-size:0.82rem;">
                                                <%= new Date(order.createdAt).toLocaleDateString('en-PK', {day:'numeric',month:'short',year:'numeric'}) %>
                                            </td>
                                        </tr>
                                        <% }); %>
                                </tbody>
                            </table>
                        </div>
                        <% } else { %>
                            <div style="text-align:center;padding:3rem;color:var(--text-muted);">
                                <p style="font-size:0.9rem;">No orders yet.</p>
                            </div>
                            <% } %>
                </div>

                <!-- Quick Actions -->
                <div class="reveal">
                    <span style="font-size:0.7rem;font-weight:700;letter-spacing:0.2em;text-transform:uppercase;color:var(--text-muted);display:block;margin-bottom:1.2rem;">Quick Actions</span>
                    <div style="display:flex;gap:1rem;flex-wrap:wrap;">
                        <% [
                        { href: '/admin/products', label: 'Manage Products', icon: '<path d="M20 7H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/><polyline points="16 3 12 7 8 3"/>' },
                        { href: '/admin/orders', label: 'Manage Orders', icon: '<path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/>' },
                        { href: '/admin/coupons', label: 'Manage Coupons', icon: '<rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/>' },
                        { href: '/admin/users', label: 'Manage Users', icon: '<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/>' }
                    ].forEach(action => { %>
                            <a href="<%= action.href %>" style="display:inline-flex;align-items:center;gap:8px;padding:0.8rem 1.4rem;background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);font-size:0.82rem;font-weight:600;letter-spacing:0.06em;color:var(--text-primary);text-decoration:none;transition:all 0.25s;"
                                onmouseover="this.style.borderColor='var(--gold)';this.style.color='var(--gold)';this.style.background='var(--gold-pale)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-primary)';this.style.background='var(--surface)'">
                                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><%- action.icon %></svg>
                                <%= action.label %>
                            </a>
                            <% }); %>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <script>
        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(e => {
                if (e.isIntersecting) {
                    e.target.classList.add('visible');
                    revealObserver.unobserve(e.target);
                }
            });
        }, {
            threshold: 0.08
        });
        document.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));

        const navbar = document.querySelector('.navbar');
        window.addEventListener('scroll', () => {
            navbar.classList.toggle('scrolled', window.scrollY > 30);
        }, {
            passive: true
        });
    </script>

    <%- include('../partials/footer') %>