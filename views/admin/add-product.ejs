<%- include('../partials/header') %>

    <main>
        <section class="section" style="padding-top:3rem;">
            <div class="container" style="max-width:860px;">

                <!-- Header -->
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:3rem;" class="reveal">
                    <div>
                        <span style="font-size:0.7rem;font-weight:600;letter-spacing:0.25em;text-transform:uppercase;color:var(--gold);display:block;margin-bottom:0.4rem;">Admin Panel</span>
                        <h1 style="font-family:var(--font-serif);font-size:2.2rem;font-weight:300;color:var(--primary);">Add New <em style="color:var(--gold);">Product</em></h1>
                    </div>
                    <a href="/admin/products" style="display:inline-flex;align-items:center;gap:6px;padding:0.7rem 1.3rem;background:transparent;border:1.5px solid var(--border);border-radius:var(--radius-sm);font-size:0.78rem;font-weight:600;color:var(--text-secondary);text-decoration:none;transition:all 0.25s;"
                        onmouseover="this.style.borderColor='var(--primary)';this.style.color='var(--primary)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-secondary)'">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg> Back to Products
                    </a>
                </div>

                <!-- Alerts -->
                <% if (typeof query !== 'undefined' && query.error) { %>
                    <div class="error-message reveal" style="margin-bottom:1.5rem;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                        <%= query.error %>
                    </div>
                    <% } %>
                        <% if (typeof error !== 'undefined' && error) { %>
                            <div class="error-message reveal" style="margin-bottom:1.5rem;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                                <%= error %>
                            </div>
                            <% } %>

                                <!-- Form -->
                                <form action="/admin/products/add" method="POST" enctype="multipart/form-data">

                                    <!-- Section: Basic Info -->
                                    <div class="reveal" style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);padding:2.5rem;margin-bottom:1.5rem;">
                                        <h2 style="font-family:var(--font-serif);font-size:1.3rem;font-weight:400;color:var(--primary);margin-bottom:0.3rem;padding-bottom:1.2rem;border-bottom:1px solid var(--border);margin-bottom:1.8rem;">
                                            Basic Information
                                        </h2>

                                        <div class="form-group">
                                            <label>Product Name</label>
                                            <input type="text" name="name" required placeholder="e.g. Embroidered Lawn Suit">
                                        </div>

                                        <div class="form-group">
                                            <label>Description</label>
                                            <textarea name="description" rows="4" required placeholder="Describe the product, fabric, embroidery style, occasion..." style="width:100%;padding:0.85rem 1rem;background:var(--cream);border:1.5px solid var(--border);border-radius:var(--radius);font-family:var(--font-body);font-size:0.95rem;resize:vertical;transition:all 0.2s;"></textarea>
                                        </div>

                                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                                            <div class="form-group">
                                                <label>Price (Rs)</label>
                                                <input type="number" name="price" step="0.01" min="0" required placeholder="0.00">
                                            </div>
                                            <div class="form-group">
                                                <label>Original Price <span style="font-weight:400;color:var(--text-muted);font-size:0.8em;">(for sale badge)</span></label>
                                                <input type="number" name="originalPrice" step="0.01" min="0" placeholder="0.00">
                                            </div>
                                        </div>

                                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                                            <div class="form-group">
                                                <label>Category</label>
                                                <select name="category" required class="filter-select" style="width:100%;padding:0.85rem 1rem;appearance:none;">
                                <option value="Men">Men</option>
                                <option value="Women">Women</option>
                                <option value="Kids">Kids</option>
                                <option value="Accessories">Accessories</option>
                            </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Shipping Fee (Rs)</label>
                                                <input type="number" name="shippingFee" step="0.01" min="0" value="250" required>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section: Variants -->
                                    <div class="reveal reveal-delay-1" style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);padding:2.5rem;margin-bottom:1.5rem;">
                                        <h2 style="font-family:var(--font-serif);font-size:1.3rem;font-weight:400;color:var(--primary);padding-bottom:1.2rem;border-bottom:1px solid var(--border);margin-bottom:1.8rem;">
                                            Variants & Inventory
                                        </h2>

                                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;align-items:start;">
                                            <div class="form-group">
                                                <label>Sizes <span style="font-weight:400;color:var(--text-muted);font-size:0.8em;">(hold Ctrl/Cmd for multiple)</span></label>
                                                <select name="sizes" multiple style="width:100%;height:140px;padding:0.5rem;background:var(--cream);border:1.5px solid var(--border);border-radius:var(--radius);font-family:var(--font-body);font-size:0.9rem;transition:all 0.2s;">
                                <option value="XS">XS</option>
                                <option value="S">S</option>
                                <option value="M">M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                                <option value="XXL">XXL</option>
                            </select>
                                            </div>
                                            <div>
                                                <div class="form-group">
                                                    <label>Colors <span style="font-weight:400;color:var(--text-muted);font-size:0.8em;">(comma-separated)</span></label>
                                                    <input type="text" name="colors" placeholder="e.g. Red, Navy, Ivory">
                                                </div>
                                                <div class="form-group">
                                                    <label>Stock Quantity</label>
                                                    <input type="number" name="stock" min="0" required placeholder="0">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Featured toggle -->
                                        <div style="display:flex;align-items:center;gap:0.8rem;padding:1.2rem;background:var(--cream);border:1.5px solid var(--border);border-radius:var(--radius);margin-top:0.5rem;cursor:pointer;" onclick="this.querySelector('input').click()">
                                            <input type="checkbox" name="featured" id="featured-check" style="width:18px;height:18px;accent-color:var(--gold);cursor:pointer;">
                                            <div>
                                                <label for="featured-check" style="font-size:0.88rem;font-weight:600;color:var(--text-primary);cursor:pointer;display:block;margin:0;">Mark as Featured Product</label>
                                                <span style="font-size:0.75rem;color:var(--text-muted);">Featured products are shown on the homepage</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section: Images -->
                                    <div class="reveal reveal-delay-2" style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);padding:2.5rem;margin-bottom:2rem;">
                                        <h2 style="font-family:var(--font-serif);font-size:1.3rem;font-weight:400;color:var(--primary);padding-bottom:1.2rem;border-bottom:1px solid var(--border);margin-bottom:1.8rem;">
                                            Product Images
                                        </h2>

                                        <div id="upload-area" style="border:2px dashed var(--border-gold);border-radius:var(--radius-lg);padding:3rem;text-align:center;background:var(--gold-pale);cursor:pointer;transition:all 0.25s;" onclick="document.getElementById('images-input').click()"
                                            ondragover="event.preventDefault();this.style.borderColor='var(--gold)';this.style.background='rgba(212,175,55,0.18)'" ondragleave="this.style.borderColor='var(--border-gold)';this.style.background='var(--gold-pale)'"
                                            ondrop="handleDrop(event)">
                                            <div style="font-size:2rem;margin-bottom:0.8rem;opacity:0.5;">ðŸ“·</div>
                                            <p style="font-weight:600;color:var(--text-primary);margin-bottom:0.3rem;">Click to upload or drag & drop</p>
                                            <p style="font-size:0.8rem;color:var(--text-muted);">JPG, JPEG, PNG â€” Max 5MB each â€” Multiple files supported</p>
                                        </div>

                                        <input type="file" id="images-input" name="images" accept=".jpg,.jpeg,.png" multiple required style="display:none;" onchange="previewImages(this)">

                                        <div id="image-preview" style="display:flex;gap:0.75rem;flex-wrap:wrap;margin-top:1.2rem;"></div>
                                    </div>

                                    <!-- Submit -->
                                    <div class="reveal reveal-delay-3" style="display:flex;gap:1rem;">
                                        <button type="submit" class="btn btn-add-cart" style="flex:1;padding:1rem;font-size:0.88rem;display:flex;align-items:center;justify-content:center;gap:8px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 12V22H4V12"/><path d="M22 7H2v5h20V7z"/><path d="M12 22V7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>
                        <span>Add Product</span>
                    </button>
                                        <a href="/admin/products" style="padding:1rem 2rem;background:transparent;border:1.5px solid var(--border);border-radius:var(--radius-sm);font-size:0.82rem;font-weight:600;color:var(--text-secondary);text-decoration:none;display:flex;align-items:center;transition:all 0.25s;"
                                            onmouseover="this.style.borderColor='var(--primary)';this.style.color='var(--primary)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-secondary)'">
                        Cancel
                    </a>
                                    </div>
                                </form>
            </div>
        </section>
    </main>

    <script>
        function previewImages(input) {
            const preview = document.getElementById('image-preview');
            preview.innerHTML = '';
            Array.from(input.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = e => {
                    const wrap = document.createElement('div');
                    wrap.style.cssText = 'position:relative;width:100px;height:120px;border-radius:8px;overflow:hidden;border:2px solid var(--border-gold);';
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.cssText = 'width:100%;height:100%;object-fit:cover;';
                    wrap.appendChild(img);
                    preview.appendChild(wrap);
                };
                reader.readAsDataURL(file);
            });
        }

        function handleDrop(e) {
            e.preventDefault();
            document.getElementById('upload-area').style.borderColor = 'var(--border-gold)';
            document.getElementById('upload-area').style.background = 'var(--gold-pale)';
            const input = document.getElementById('images-input');
            input.files = e.dataTransfer.files;
            previewImages(input);
        }

        // Focus styles for textarea
        document.querySelector('textarea').addEventListener('focus', function() {
            this.style.borderColor = 'var(--gold)';
            this.style.background = '#fff';
            this.style.boxShadow = '0 0 0 3px var(--gold-pale)';
        });
        document.querySelector('textarea').addEventListener('blur', function() {
            this.style.borderColor = 'var(--border)';
            this.style.background = 'var(--cream)';
            this.style.boxShadow = 'none';
        });

        // Select focus
        document.querySelector('select[multiple]').addEventListener('focus', function() {
            this.style.borderColor = 'var(--gold)';
            this.style.boxShadow = '0 0 0 3px var(--gold-pale)';
        });
        document.querySelector('select[multiple]').addEventListener('blur', function() {
            this.style.borderColor = 'var(--border)';
            this.style.boxShadow = 'none';
        });

        // Scroll reveal
        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(e => {
                if (e.isIntersecting) {
                    e.target.classList.add('visible');
                    revealObserver.unobserve(e.target);
                }
            });
        }, {
            threshold: 0.08
        });
        document.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));

        const navbar = document.querySelector('.navbar');
        window.addEventListener('scroll', () => {
            navbar.classList.toggle('scrolled', window.scrollY > 30);
        }, {
            passive: true
        });
    </script>

    <%- include('../partials/footer') %>