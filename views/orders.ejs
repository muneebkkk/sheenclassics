<%- include('partials/header') %>

    <main>
        <section class="section">
            <div class="container" style="max-width:1000px;">

                <!-- Page Header -->
                <div class="section-header reveal" style="margin-bottom:3rem;">
                    <span class="section-eyebrow">History</span>
                    <h1 class="section-title">My <em>Orders</em></h1>
                    <div class="section-divider"></div>
                </div>

                <% if (orders && orders.length > 0) { %>
                    <div style="display:flex;flex-direction:column;gap:1.5rem;">
                        <% orders.forEach((order, i) => { %>

                            <div class="reveal reveal-delay-<%= Math.min(i % 4 + 1, 4) %>" style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;transition:border-color 0.3s,box-shadow 0.3s;" onmouseover="this.style.borderColor='var(--border-gold)';this.style.boxShadow='var(--shadow-sm)'"
                                onmouseout="this.style.borderColor='var(--border)';this.style.boxShadow='none'">

                                <!-- Header bar -->
                                <div style="display:flex;justify-content:space-between;align-items:center;padding:1.4rem 1.8rem;background:var(--cream);border-bottom:1px solid var(--border);flex-wrap:wrap;gap:1rem;">
                                    <div style="display:flex;align-items:center;gap:1.2rem;flex-wrap:wrap;">
                                        <span style="font-family:var(--font-display);font-size:0.92rem;font-weight:600;letter-spacing:0.05em;color:var(--primary);">
                                #<%= order._id.toString().substring(0, 8).toUpperCase() %>
                            </span>
                                        <span class="badge badge-<%= order.status %>"><%= order.status %></span>
                                        <span style="font-size:0.78rem;color:var(--text-muted);">
                                <%= new Date(order.createdAt).toLocaleDateString('en-PK', {day:'numeric',month:'long',year:'numeric'}) %>
                            </span>
                                    </div>
                                    <div style="font-family:var(--font-serif);font-size:1.7rem;font-weight:300;color:var(--gold);line-height:1;">
                                        Rs
                                        <%= order.total.toFixed(2) %>
                                    </div>
                                </div>

                                <!-- Items -->
                                <div style="padding:1.5rem 1.8rem;">
                                    <% order.items.forEach(item => { %>
                                        <div style="display:flex;gap:1.2rem;align-items:center;padding:0.9rem 0;border-bottom:1px solid var(--border);">
                                            <img src="<%= item.product.images && item.product.images[0] ? item.product.images[0] : '/images/p1.jpeg' %>" alt="<%= item.product.name %>" style="width:70px;height:88px;object-fit:cover;border-radius:var(--radius);flex-shrink:0;">

                                            <div style="flex:1;min-width:0;">
                                                <h4 style="font-family:var(--font-serif);font-size:1.05rem;font-weight:400;color:var(--primary);margin-bottom:0.25rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
                                                    <%= item.product.name %>
                                                </h4>
                                                <p style="font-size:0.78rem;color:var(--text-muted);">
                                                    Qty:
                                                    <%= item.quantity %>
                                                        <% if (item.size) { %> &nbsp;Â·&nbsp; Size:
                                                            <%= item.size %>
                                                                <% } %>
                                                                    <% if (item.color) { %> &nbsp;Â·&nbsp; Color:
                                                                        <%= item.color %>
                                                                            <% } %>
                                                </p>
                                            </div>

                                            <div style="font-weight:600;font-size:0.95rem;color:var(--primary);flex-shrink:0;">
                                                Rs
                                                <%= (item.price * item.quantity).toFixed(2) %>
                                            </div>
                                        </div>
                                        <% }); %>
                                </div>

                                <!-- Actions -->
                                <div style="padding:1.2rem 1.8rem;border-top:1px solid var(--border);display:flex;gap:0.75rem;flex-wrap:wrap;">
                                    <a href="/orders/<%= order._id %>" style="flex:1;min-width:160px;display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:0.75rem 1.5rem;background:var(--primary);color:#fff;border-radius:var(--radius-sm);font-size:0.78rem;font-weight:600;letter-spacing:0.08em;text-transform:uppercase;text-decoration:none;transition:all 0.25s;"
                                        onmouseover="this.style.background='var(--gold)';this.style.color='var(--primary)'" onmouseout="this.style.background='var(--primary)';this.style.color='#fff'">
                            View Details
                            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                        </a>
                                </div>
                            </div>

                            <% }); %>
                    </div>

                    <% } else { %>
                        <!-- Empty State -->
                        <div class="empty-state reveal">
                            <div class="empty-state-icon">ðŸ“¦</div>
                            <h3>No orders yet</h3>
                            <p style="margin-bottom:2rem;">Your order history will appear here once you make a purchase.</p>
                            <a href="/products" class="btn btn-add-cart" style="display:inline-flex;padding:0.85rem 2.5rem;text-decoration:none;">
                                <span>Start Shopping</span>
                            </a>
                        </div>
                        <% } %>

            </div>
        </section>
    </main>

    <script>
        // Scroll reveal
        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(e => {
                if (e.isIntersecting) {
                    e.target.classList.add('visible');
                    revealObserver.unobserve(e.target);
                }
            });
        }, {
            threshold: 0.08
        });
        document.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));

        // Navbar
        const navbar = document.querySelector('.navbar');
        window.addEventListener('scroll', () => {
            navbar.classList.toggle('scrolled', window.scrollY > 30);
        }, {
            passive: true
        });

        // Mobile menu
        const toggle = document.querySelector('.mobile-menu-toggle');
        const menu = document.querySelector('.nav-menu');
        const overlay = document.querySelector('.nav-overlay');
        if (toggle && menu) {
            function toggleMenu(open) {
                toggle.classList.toggle('open', open);
                menu.classList.toggle('active', open);
                overlay && overlay.classList.toggle('active', open);
                document.body.style.overflow = open ? 'hidden' : '';
            }
            toggle.addEventListener('click', () => toggleMenu(!menu.classList.contains('active')));
            overlay && overlay.addEventListener('click', () => toggleMenu(false));
        }
    </script>

    <%- include('partials/footer') %>