<%- include('partials/header') %>

    <main>
        <section class="section">
            <div class="container" style="max-width:1100px;">

                <!-- Page Header -->
                <div class="section-header reveal" style="margin-bottom:2.5rem; text-align:left;">
                    <span class="section-eyebrow"><%= user ? 'Welcome back' : 'Guest Account' %></span>
                    <h1 class="section-title"><em><%= user ? user.name.split(' ')[0] : 'Guest' %></em></h1>
                    <div class="section-divider" style="margin:1.2rem 0 0;"></div>
                </div>

                <!-- Messages -->
                <% if (typeof query !== 'undefined' && query.success) { %>
                    <div class="success-message reveal">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                        <%= query.success %>
                    </div>
                    <% } %>
                        <% if (typeof query !== 'undefined' && query.error) { %>
                            <div class="error-message reveal">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                                <%= query.error %>
                            </div>
                            <% } %>

                                <!-- Tabs -->
                                <div class="account-tabs reveal">
                                    <% if (user) { %>
                                        <button class="tab-btn <%= activeTab === 'profile'  ? 'active' : '' %>" onclick="switchTab('profile')">
                    Profile
                </button>
                                        <% } %>
                                            <button class="tab-btn <%= activeTab === 'cart'     ? 'active' : '' %>" onclick="switchTab('cart')">
                    Cart
                    <% if (cart.items && cart.items.length > 0) { %>
                    <span style="display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;background:var(--gold);color:var(--primary);border-radius:50%;font-size:0.65rem;font-weight:700;margin-left:4px;"><%= cart.items.length %></span>
                    <% } %>
                </button>
                                            <button class="tab-btn <%= activeTab === 'wishlist'  ? 'active' : '' %>" onclick="switchTab('wishlist')">
                    Wishlist
                    <% if (wishlist.products && wishlist.products.length > 0) { %>
                    <span style="display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;background:var(--gold);color:var(--primary);border-radius:50%;font-size:0.65rem;font-weight:700;margin-left:4px;"><%= wishlist.products.length %></span>
                    <% } %>
                </button>
                                            <% if (user) { %>
                                                <button class="tab-btn <%= activeTab === 'orders'  ? 'active' : '' %>" onclick="switchTab('orders')">
                    Orders
                    <% if (orders && orders.length > 0) { %>
                    <span style="display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;background:var(--gold);color:var(--primary);border-radius:50%;font-size:0.65rem;font-weight:700;margin-left:4px;"><%= orders.length %></span>
                    <% } %>
                </button>
                                                <% } %>
                                </div>

                                <!-- ============================
                 PROFILE TAB
                 ============================ -->
                                <% if (user) { %>
                                    <div id="profile-tab" class="tab-content <%= activeTab === 'profile' ? 'active' : '' %>">
                                        <div style="display:grid; grid-template-columns:1fr 2fr; gap:3rem; align-items:start; max-width:900px;">

                                            <!-- Avatar Card -->
                                            <div style="background:var(--cream); border:1px solid var(--border); border-radius:var(--radius-xl); padding:2rem; text-align:center;">
                                                <div style="width:80px;height:80px;border-radius:50%;background:var(--primary);color:var(--gold);font-family:var(--font-display);font-size:2rem;font-weight:600;display:flex;align-items:center;justify-content:center;margin:0 auto 1rem;">
                                                    <%= user.name.charAt(0).toUpperCase() %>
                                                </div>
                                                <h3 style="font-family:var(--font-serif);font-size:1.3rem;font-weight:400;margin-bottom:0.3rem;">
                                                    <%= user.name %>
                                                </h3>
                                                <p style="font-size:0.82rem;color:var(--text-muted);margin-bottom:1.2rem;">
                                                    <%= user.email %>
                                                </p>
                                                <div style="font-size:0.75rem;color:var(--text-muted);border-top:1px solid var(--border);padding-top:1rem;">
                                                    <div style="display:flex;justify-content:space-between;margin-bottom:0.5rem;">
                                                        <span>Orders</span><strong style="color:var(--text-primary)"><%= orders ? orders.length : 0 %></strong>
                                                    </div>
                                                    <div style="display:flex;justify-content:space-between;margin-bottom:0.5rem;">
                                                        <span>Wishlist</span><strong style="color:var(--text-primary)"><%= wishlist.products ? wishlist.products.length : 0 %></strong>
                                                    </div>
                                                    <div style="display:flex;justify-content:space-between;">
                                                        <span>Cart Items</span><strong style="color:var(--text-primary)"><%= cart.items ? cart.items.length : 0 %></strong>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Form -->
                                            <form action="/account/update" method="POST">
                                                <div style="margin-bottom:2rem;">
                                                    <h2 style="font-family:var(--font-serif);font-size:1.6rem;font-weight:400;margin-bottom:0.3rem;">Personal Information</h2>
                                                    <p style="font-size:0.85rem;color:var(--text-muted);">Update your name and contact details</p>
                                                </div>

                                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                                                    <div class="form-group" style="grid-column:span 2;">
                                                        <label>Full Name</label>
                                                        <input type="text" name="name" value="<%= user.name %>" required>
                                                    </div>
                                                    <div class="form-group" style="grid-column:span 2;">
                                                        <label>Email <span style="color:var(--text-muted);font-weight:400;font-size:0.75em;">(cannot be changed)</span></label>
                                                        <input type="email" value="<%= user.email %>" disabled style="background:var(--cream);cursor:not-allowed;opacity:0.7;">
                                                    </div>
                                                    <div class="form-group" style="grid-column:span 2;">
                                                        <label>Phone Number</label>
                                                        <input type="text" name="phone" value="<%= user.phone || '' %>" placeholder="e.g. +92 300 0000000">
                                                    </div>
                                                </div>

                                                <div style="margin:2rem 0 1.2rem; padding-top:1.5rem; border-top:1px solid var(--border);">
                                                    <h3 style="font-family:var(--font-serif);font-size:1.3rem;font-weight:400;margin-bottom:0.3rem;">Shipping Address</h3>
                                                    <p style="font-size:0.82rem;color:var(--text-muted);">This will be pre-filled at checkout</p>
                                                </div>

                                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                                                    <div class="form-group" style="grid-column:span 2;">
                                                        <label>Street Address</label>
                                                        <input type="text" name="street" value="<%= user.address && user.address.street ? user.address.street : '' %>" placeholder="House / Flat, Street name">
                                                    </div>
                                                    <div class="form-group">
                                                        <label>City</label>
                                                        <input type="text" name="city" value="<%= user.address && user.address.city ? user.address.city : '' %>">
                                                    </div>
                                                    <div class="form-group">
                                                        <label>State / Province</label>
                                                        <input type="text" name="state" value="<%= user.address && user.address.state ? user.address.state : '' %>">
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Zip / Postal Code</label>
                                                        <input type="text" name="zipCode" value="<%= user.address && user.address.zipCode ? user.address.zipCode : '' %>">
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Country</label>
                                                        <input type="text" name="country" value="<%= user.address && user.address.country ? user.address.country : 'Pakistan' %>">
                                                    </div>
                                                </div>

                                                <button type="submit" class="btn btn-add-cart" style="width:100%; margin-top:1rem; padding:0.9rem; font-size:0.85rem; display:flex; justify-content:center; align-items:center; gap:8px;">
                            <span>Save Changes</span>
                        </button>
                                            </form>
                                        </div>
                                    </div>
                                    <% } %>

                                        <!-- ============================
                 CART TAB
                 ============================ -->
                                        <div id="cart-tab" class="tab-content <%= activeTab === 'cart' ? 'active' : '' %>">
                                            <% if (cart.items && cart.items.length > 0) { %>

                                                <%
                    let cartSubtotalCalc = typeof cartSubtotal !== 'undefined' ? cartSubtotal : 0;
                    if (typeof cartSubtotal === 'undefined') {
                        cart.items.forEach(item => { if (!item.productNotFound) cartSubtotalCalc += item.product.price * item.quantity; });
                    }
                %>

                                                    <div class="cart-layout">
                                                        <div class="cart-items-col">
                                                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid var(--border);">
                                                                <span style="font-size:0.78rem;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:var(--text-muted);"><%= cart.items.length %> item<%= cart.items.length !== 1 ? 's' : '' %></span>
                                                                <a href="/products" style="font-size:0.82rem;color:var(--gold);font-weight:500;display:flex;align-items:center;gap:4px;">
                                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg> Continue Shopping
                                                                </a>
                                                            </div>

                                                            <% cart.items.forEach((item, i) => { %>
                                                                <% if (item.productNotFound) { %>
                                                                    <div class="cart-item" style="border-color: rgba(231,76,60,0.3); background: rgba(231,76,60,0.02);">
                                                                        <div style="width:110px;height:140px;flex-shrink:0;background:var(--cream);border-radius:var(--radius);display:flex;align-items:center;justify-content:center;text-align:center;color:#c0392b;font-size:0.75rem;font-weight:600;padding:1rem;">
                                                                            Item<br>Unavailable
                                                                        </div>
                                                                        <div class="cart-item-details">
                                                                            <h3 class="cart-item-name" style="color:#c0392b;">Product No Longer Available</h3>
                                                                            <p style="font-size:0.82rem;color:var(--text-muted);margin-bottom:1rem;">This item has been removed from our catalog.</p>
                                                                            <button onclick="removeFromCart('<%= item._id %>')" style="background:none;border:1px solid rgba(231,76,60,0.4);color:#c0392b;padding:0.5rem 1rem;border-radius:var(--radius-sm);font-size:0.78rem;font-weight:600;cursor:pointer;font-family:var(--font-body);transition:all 0.2s;"
                                                                                onmouseover="this.style.background='rgba(231,76,60,0.08)'" onmouseout="this.style.background='none'">
                                    Remove from Cart
                                </button>
                                                                        </div>
                                                                    </div>
                                                                    <% } else { %>
                                                                        <div class="cart-item">
                                                                            <img src="<%= item.product.images && item.product.images[0] ? item.product.images[0] : '/images/p1.jpeg' %>" alt="<%= item.product.name %>" class="cart-item-image">
                                                                            <div class="cart-item-details">
                                                                                <div style="display:flex;justify-content:space-between;align-items:start;gap:1rem;">
                                                                                    <div>
                                                                                        <h3 class="cart-item-name">
                                                                                            <%= item.product.name %>
                                                                                        </h3>
                                                                                        <div style="display:flex;gap:1rem;margin-top:0.3rem;flex-wrap:wrap;">
                                                                                            <% if (item.size) { %><span style="font-size:0.78rem;color:var(--text-muted);">Size: <strong style="color:var(--text-secondary)"><%= item.size %></strong></span>
                                                                                                <% } %>
                                                                                                    <% if (item.color) { %><span style="font-size:0.78rem;color:var(--text-muted);">Color: <strong style="color:var(--text-secondary)"><%= item.color %></strong></span>
                                                                                                        <% } %>
                                                                                        </div>
                                                                                        <% if (item.stockWarning) { %>
                                                                                            <p style="font-size:0.78rem;color:#c17f0a;font-weight:500;margin-top:0.5rem;display:flex;align-items:center;gap:4px;">
                                                                                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>                                                                                                Only
                                                                                                <%= item.product.stock %> left
                                                                                            </p>
                                                                                            <% } %>
                                                                                    </div>
                                                                                    <div class="cart-item-price">Rs
                                                                                        <%= (item.product.price * item.quantity).toFixed(2) %>
                                                                                    </div>
                                                                                </div>

                                                                                <div style="display:flex;align-items:center;justify-content:space-between;margin-top:1.2rem;flex-wrap:wrap;gap:1rem;">
                                                                                    <div class="quantity-control">
                                                                                        <button class="quantity-btn" onclick="updateCartQuantity('<%= item._id %>', <%= item.quantity - 1 %>)">‚àí</button>
                                                                                        <span class="quantity-value"><%= item.quantity %></span>
                                                                                        <button class="quantity-btn" onclick="updateCartQuantity('<%= item._id %>', <%= item.quantity + 1 %>)">+</button>
                                                                                    </div>
                                                                                    <button onclick="removeFromCart('<%= item._id %>')" style="background:none;border:none;cursor:pointer;font-size:0.78rem;font-weight:500;color:var(--text-muted);letter-spacing:0.05em;display:flex;align-items:center;gap:4px;transition:color 0.2s;font-family:var(--font-body);"
                                                                                        onmouseover="this.style.color='#e74c3c'" onmouseout="this.style.color='var(--text-muted)'">
                                        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/></svg>
                                        Remove
                                    </button>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <% } %>
                                                                            <% }); %>
                                                        </div>

                                                        <!-- Summary -->
                                                        <div>
                                                            <div class="cart-summary">
                                                                <h3>Order Summary</h3>
                                                                <div class="summary-row"><span>Subtotal</span><span>Rs <%= cartSubtotalCalc.toFixed(2) %></span></div>
                                                                <div class="summary-row"><span>Shipping</span><span>Rs 250</span></div>
                                                                <div class="summary-row total">
                                                                    <span>Total</span>
                                                                    <span style="color:var(--gold)">Rs <%= (cartSubtotalCalc + 250) %></span>
                                                                </div>
                                                                <a href="/orders/summary" class="btn btn-add-cart" style="width:100%;margin-top:1.5rem;padding:1rem;display:flex;justify-content:center;align-items:center;gap:8px;text-decoration:none;font-size:0.85rem;">
                                                                    <span>Proceed to Checkout</span>
                                                                    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                                                                </a>
                                                                <p style="text-align:center;font-size:0.75rem;color:var(--text-muted);margin-top:0.8rem;display:flex;align-items:center;justify-content:center;gap:4px;">
                                                                    <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>                                                                    Secure checkout
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <% } else { %>
                                                        <div class="empty-state">
                                                            <div class="empty-state-icon">üõçÔ∏è</div>
                                                            <h3>Your cart is empty</h3>
                                                            <p style="margin-bottom:1.5rem;">Add some pieces to your cart and they'll appear here.</p>
                                                            <a href="/products" class="btn btn-add-cart" style="display:inline-flex;padding:0.85rem 2.5rem;text-decoration:none;"><span>Browse Collection</span></a>
                                                        </div>
                                                        <% } %>
                                        </div>

                                        <!-- ============================
                 WISHLIST TAB
                 ============================ -->
                                        <div id="wishlist-tab" class="tab-content <%= activeTab === 'wishlist' ? 'active' : '' %>">
                                            <% if (wishlist.products && wishlist.products.length > 0) { %>
                                                <div class="product-grid">
                                                    <% wishlist.products.forEach((product, i) => { %>
                                                        <div class="product-card reveal reveal-delay-<%= Math.min(i % 4 + 1, 4) %>" onclick="window.location.href='/products/<%= product._id %>'">
                                                            <div class="product-image-wrap">
                                                                <img src="<%= product.images && product.images[0] ? product.images[0] : '/images/p1.jpeg' %>" alt="<%= product.name %>" class="product-image" loading="lazy">
                                                                <div class="product-overlay">
                                                                    <button class="product-quick-add" onclick="event.stopPropagation(); addToCart('<%= product._id %>')">Quick Add</button>
                                                                </div>
                                                            </div>
                                                            <div class="product-info">
                                                                <h3 class="product-name">
                                                                    <%= product.name %>
                                                                </h3>
                                                                <div class="product-price">
                                                                    Rs
                                                                    <%= product.price.toFixed(2) %>
                                                                        <% if (product.originalPrice && product.originalPrice > product.price) { %>
                                                                            <span class="original">Rs <%= product.originalPrice.toFixed(2) %></span>
                                                                            <% } %>
                                                                </div>
                                                                <div class="product-actions">
                                                                    <button class="btn btn-add-cart" onclick="event.stopPropagation(); addToCart('<%= product._id %>')">
                                    <span>Add to Cart</span>
                                </button>
                                                                    <button class="btn btn-wishlist active" onclick="event.stopPropagation(); removeFromWishlist('<%= product._id %>')" title="Remove from wishlist">‚ô•</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% }); %>
                                                </div>
                                                <% } else { %>
                                                    <div class="empty-state">
                                                        <div class="empty-state-icon">‚ô°</div>
                                                        <h3>Your wishlist is empty</h3>
                                                        <p style="margin-bottom:1.5rem;">Save pieces you love and find them here.</p>
                                                        <a href="/products" class="btn btn-add-cart" style="display:inline-flex;padding:0.85rem 2.5rem;text-decoration:none;"><span>Browse Collection</span></a>
                                                    </div>
                                                    <% } %>
                                        </div>

                                        <!-- ============================
                 ORDERS TAB
                 ============================ -->
                                        <% if (user) { %>
                                            <div id="orders-tab" class="tab-content <%= activeTab === 'orders' ? 'active' : '' %>">
                                                <% if (orders && orders.length > 0) { %>
                                                    <div style="display:flex;flex-direction:column;gap:1.5rem;">
                                                        <% orders.forEach((order, i) => { %>
                                                            <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;transition:var(--transition);" onmouseover="this.style.borderColor='var(--border-gold)';this.style.boxShadow='var(--shadow-sm)'" onmouseout="this.style.borderColor='var(--border)';this.style.boxShadow='none'">

                                                                <!-- Order Header -->
                                                                <div style="display:flex;justify-content:space-between;align-items:center;padding:1.4rem 1.8rem;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:1rem;">
                                                                    <div>
                                                                        <div style="display:flex;align-items:center;gap:0.8rem;margin-bottom:0.3rem;">
                                                                            <span style="font-family:var(--font-display);font-size:0.9rem;font-weight:600;letter-spacing:0.05em;">Order #<%= order._id.toString().substring(0, 8).toUpperCase() %></span>
                                                                            <span class="badge badge-<%= order.status %>"><%= order.status %></span>
                                                                        </div>
                                                                        <span style="font-size:0.78rem;color:var(--text-muted);">Placed <%= new Date(order.createdAt).toLocaleDateString('en-PK', {day:'numeric',month:'long',year:'numeric'}) %></span>
                                                                    </div>
                                                                    <div style="text-align:right;">
                                                                        <div style="font-family:var(--font-serif);font-size:1.6rem;font-weight:400;color:var(--gold);line-height:1;">Rs
                                                                            <%= order.total.toFixed(2) %>
                                                                        </div>
                                                                        <div style="font-size:0.75rem;color:var(--text-muted);margin-top:0.2rem;">
                                                                            <%= order.items.length %> item
                                                                                <%= order.items.length !== 1 ? 's' : '' %>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <!-- Order Items Preview -->
                                                                <div style="padding:1.2rem 1.8rem;">
                                                                    <% order.items.forEach(item => { %>
                                                                        <div style="display:flex;gap:1rem;align-items:center;padding:0.8rem 0;border-bottom:1px solid var(--border);">
                                                                            <img src="<%= item.product.images && item.product.images[0] ? item.product.images[0] : '/images/p1.jpeg' %>" alt="<%= item.product.name %>" style="width:60px;height:75px;object-fit:cover;border-radius:var(--radius-sm);flex-shrink:0;">
                                                                            <div style="flex:1;min-width:0;">
                                                                                <h4 style="font-family:var(--font-serif);font-size:1rem;font-weight:400;color:var(--primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
                                                                                    <%= item.product.name %>
                                                                                </h4>
                                                                                <p style="font-size:0.78rem;color:var(--text-muted);margin-top:0.2rem;">Qty:
                                                                                    <%= item.quantity %>
                                                                                </p>
                                                                            </div>
                                                                            <div style="font-size:0.9rem;font-weight:600;color:var(--gold);flex-shrink:0;">Rs
                                                                                <%= (item.price * item.quantity).toFixed(2) %>
                                                                            </div>
                                                                        </div>
                                                                        <% }); %>
                                                                </div>

                                                                <!-- Order Actions -->
                                                                <div style="padding:1.2rem 1.8rem;background:var(--cream);display:flex;gap:0.75rem;flex-wrap:wrap;">
                                                                    <a href="/orders/<%= order._id %>" style="flex:1;min-width:140px;display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:0.7rem 1.2rem;background:var(--primary);color:#fff;border-radius:var(--radius-sm);font-size:0.78rem;font-weight:600;letter-spacing:0.06em;text-transform:uppercase;text-decoration:none;transition:var(--transition);"
                                                                        onmouseover="this.style.background='var(--gold)';this.style.color='var(--primary)'" onmouseout="this.style.background='var(--primary)';this.style.color='#fff'">
                                View Details
                                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                            </a>
                                                                    <% if (order.status === 'pending' || order.status === 'processing') { %>
                                                                        <button onclick="cancelOrder('<%= order._id %>')" style="flex:1;min-width:140px;display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:0.7rem 1.2rem;background:transparent;border:1.5px solid rgba(192,57,43,0.3);color:#c0392b;border-radius:var(--radius-sm);font-size:0.78rem;font-weight:600;letter-spacing:0.06em;text-transform:uppercase;cursor:pointer;font-family:var(--font-body);transition:var(--transition);"
                                                                            onmouseover="this.style.background='rgba(192,57,43,0.06)';this.style.borderColor='rgba(192,57,43,0.6)'" onmouseout="this.style.background='transparent';this.style.borderColor='rgba(192,57,43,0.3)'">
                                Cancel Order
                            </button>
                                                                        <% } %>
                                                                </div>
                                                            </div>
                                                            <% }); %>
                                                    </div>
                                                    <% } else { %>
                                                        <div class="empty-state">
                                                            <div class="empty-state-icon">üì¶</div>
                                                            <h3>No orders yet</h3>
                                                            <p style="margin-bottom:1.5rem;">Your order history will appear here once you make a purchase.</p>
                                                            <a href="/products" class="btn btn-add-cart" style="display:inline-flex;padding:0.85rem 2.5rem;text-decoration:none;"><span>Start Shopping</span></a>
                                                        </div>
                                                        <% } %>
                                            </div>
                                            <% } %>

            </div>
        </section>
    </main>

    <script>
        function switchTab(tab) {
            window.location.href = '/account?tab=' + tab;
        }

        async function cancelOrder(orderId) {
            if (!confirm('Are you sure you want to cancel this order?')) return;
            try {
                const response = await fetch(`/orders/${orderId}/cancel`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                if (data.success) {
                    showNotification(data.message, 'success');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('Failed to cancel order', 'error');
            }
        }

        // Scroll reveal
        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(e => {
                if (e.isIntersecting) {
                    e.target.classList.add('visible');
                    revealObserver.unobserve(e.target);
                }
            });
        }, {
            threshold: 0.08
        });
        document.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));

        // Mobile menu
        const toggle = document.querySelector('.mobile-menu-toggle');
        const menu = document.querySelector('.nav-menu');
        const overlay = document.querySelector('.nav-overlay');
        if (toggle && menu) {
            function toggleMenu(open) {
                toggle.classList.toggle('open', open);
                menu.classList.toggle('active', open);
                overlay && overlay.classList.toggle('active', open);
                document.body.style.overflow = open ? 'hidden' : '';
            }
            toggle.addEventListener('click', () => toggleMenu(!menu.classList.contains('active')));
            overlay && overlay.addEventListener('click', () => toggleMenu(false));
        }
    </script>

    <%- include('partials/footer') %>